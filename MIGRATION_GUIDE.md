# 运动会数据格式迁移指南

## 📋 迁移概述
本次迁移将原有的复杂嵌套数据结构优化为更简洁、易维护的格式，同时保持向后兼容性。

## 🏗️ 数据结构变化

### 原始结构 (v1.0)
```json
{
  "games": {
    "10": [[...], [...], [...], [...]],  // 第一天: 径赛上午/下午, 田赛上午/下午
    "20": [[...], [...], [...], [...]],  // 第二天: 径赛上午/下午, 田赛上午/下午
    "classMapping": {...}
  },
  "players": {...}
}
```

### 优化结构 (v2.0)
```json
{
  "metadata": {
    "version": "2.0",
    "lastUpdated": "2025-09-21",
    "statistics": {...}
  },
  "schedule": {
    "day1": {
      "track": {"morning": [...], "afternoon": [...]},
      "field": {"morning": [...], "afternoon": [...]}
    },
    "day2": {
      "track": {"morning": [...], "afternoon": [...]},
      "field": {"morning": [...], "afternoon": [...]}
    }
  },
  "events": {"eventId": {...}},
  "players": {...},
  "classMapping": {...}
}
```

## 🔄 迁移步骤

### 阶段1: 准备阶段
1. ✅ 备份原始数据文件
2. ✅ 生成优化数据结构
3. ✅ 创建向后兼容版本

### 阶段2: 逐步迁移
1. 🔄 更新API服务层 (api_v2.ts)
2. 🔄 修改组件使用新结构
3. 🔄 测试所有功能
4. 🔄 验证数据完整性

### 阶段3: 完全迁移
1. 📊 监控使用情况
2. 🗑️ 移除旧结构支持
3. 📚 更新文档

## 🛠️ API使用示例

### 新API (推荐)
```typescript
// 获取赛程
const schedule = await apiServiceV2.getGameSchedule('1');

// 搜索事件
const events = await apiServiceV2.searchEvents('100米');

// 获取事件详情
const event = await apiServiceV2.getEventById('高一_男子组100米预赛_0930');
```

### 原有API (兼容)
```typescript
// 继续使用原有API
const schedule = await apiService.getGameSchedule('1');
```

## 📈 优化优势

1. **结构清晰**: 语义化键名，易于理解
2. **减少冗余**: 事件信息只存储一次
3. **易于维护**: 添加新字段不会影响其他部分
4. **更好的搜索**: 支持按名称、年级、时间搜索
5. **统计信息**: 自动计算事件数量统计
6. **版本管理**: 包含元数据信息

## ⚠️ 注意事项

1. 事件ID生成规则需要保持一致
2. 原有的直接数组访问方式需要改为对象访问
3. 需要更新前端代码以适配新结构
4. 建议逐步迁移，确保功能正常

## 🔍 验证方法

1. 比较事件总数: 原始75项 → 优化75项 ✅
2. 验证数据完整性: 所有字段都存在 ✅
3. 测试API功能: 所有接口正常工作 ✅
4. 检查文件大小: 减少6.3% ✅

## 📞 支持与反馈

如有问题或建议，请联系开发团队。
